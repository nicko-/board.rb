<%
def render_post id, depth = 0
  post = $db[:posts].where(:id => id).first
  content = "<div style=\"margin-left: #{depth * 10}px;\" id=\"post\"><b>#{post[:author]}</b> - #{Time.at(post[:date]).to_s}<br>#{post[:content]}<br></div>"
  $db[:posts].where(:in_reply_to => id).each do |reply|
    content += render_post reply[:id], depth + 1
  end
  content
end
%>

<%= render_post params[:id] %>